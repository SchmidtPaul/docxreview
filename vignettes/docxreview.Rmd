---
title: "Getting Started with docxreview"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting Started with docxreview}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## The Workflow

A common workflow in reproducible reporting:

1. Write your report in Quarto (`.qmd`) or R Markdown (`.Rmd`).
2. Render to `.docx` for review.
3. A reviewer opens the Word document, adds **comments** and **tracked changes**.
4. You receive the reviewed `.docx` and manually work through each piece of
   feedback to update your source document.

Step 4 is tedious and error-prone. **docxreview** automates the extraction of
reviewer feedback so you can focus on revising your source.

## A Concrete Example

To demonstrate the full workflow, we use a short Quarto report that analyzes
R's built-in `PlantGrowth` dataset. The source files are available in the
[vignettes/ directory](https://github.com/SchmidtPaul/docxreview/tree/master/vignettes)
of the GitHub repository:

| File | Description |
|------|-------------|
| `example-report.qmd` | Original Quarto source |
| `example-report.docx` | Rendered Word document |
| `example-report-reviewed.docx` | Word document after review |

## The Source Document

The original report (`example-report.qmd`) contains a few intentional
imperfections that a reviewer would flag:

- **Typos** in the introduction: "analzes" instead of "analyzes" and "determin"
  instead of "determine"
- **Visible R code** in the rendered document (no `echo: false`)
- **Small font size** in the plot (ggplot2 default theme)

After rendering with `quarto render example-report.qmd --to docx`, the `.docx`
file is sent to a reviewer.

## The Review

The reviewer opens the document in Microsoft Word with Track Changes enabled and:

1. **Corrects the typos** — Word tracks these as insertions of the missing
   characters ("y" in "analyzes", "e" in "determine")
2. **Adds a comment** on a code block: *"Hide the R code in the final report"*
3. **Adds a comment** on the figure: *"Increase the font size in this figure"*

The result is `example-report-reviewed.docx` — a document with 2 comments and
2 tracked changes.

## Extracting Feedback

With docxreview, extracting all feedback takes a single function call:

```r
library(docxreview)

extract_review("example-report-reviewed.docx")
```

This prints a structured Markdown summary to the console:

```
# Review Feedback: example-report-reviewed.docx

## Comments (2)

### 1. Paul Schmidt - BioMath GmbH (2026-02-14)
> **Commented text:** "data"
> **Paragraph:** "data(PlantGrowth)group_summary <- aggregate( ..."

**Comment:** Hide the R code in the final report

---

### 2. Paul Schmidt - BioMath GmbH (2026-02-14)
> **Commented text:** ""
> **Paragraph:** ""

**Comment:** Increase the font size in this figure

---

## Tracked Changes (2)

### 1. [Insertion] Paul Schmidt - BioMath GmbH (2026-02-14)
> **Inserted:** "y"
> **Paragraph:** "This report anal**y**zes the PlantGrowth dataset, ..."

---

### 2. [Insertion] Paul Schmidt - BioMath GmbH (2026-02-14)
> **Inserted:** "e"
> **Paragraph:** "This r**e**port analyzes the PlantGrowth dataset, ..."

---
```

## Output Options

Save to a file instead of printing to the console:

```r
extract_review("example-report-reviewed.docx", output_file = "feedback.md")
```

**Anonymize reviewer names** with `anonymize = TRUE`. This replaces all author
names with neutral aliases ("Reviewer 1", "Reviewer 2", ...) in the Markdown
output — including any `@mentions` within comment text. A sidecar
`feedback-reviewers.md` mapping file is written alongside the output file:

```r
extract_review("example-report-reviewed.docx", output_file = "feedback.md",
               anonymize = TRUE)
```

**Group feedback by reviewer** with `group_by_author = TRUE`:

```r
extract_review("example-report-reviewed.docx", group_by_author = TRUE)
```

## Programmatic Access

For filtering or further processing, use the individual extraction functions
that return tibbles:

```r
comments <- extract_comments("example-report-reviewed.docx")
comments
```

```
# A tibble: 2 x 9
  comment_id author                      date       comment_text    commented_text paragraph_context
  <chr>      <chr>                       <chr>      <chr>           <chr>         <chr>
1 4          Paul Schmidt - BioMath GmbH 2026-02-14 Hide the R ...  "data"        "data(PlantGro..."
2 7          Paul Schmidt - BioMath GmbH 2026-02-14 Increase th...  ""            ""
# ... with 3 more variables: parent_comment_id <chr>, page <int>, section <chr>
```

```r
changes <- extract_tracked_changes("example-report-reviewed.docx")
changes
```

```
# A tibble: 2 x 8
  change_id type      author                      date       changed_text paragraph_context
      <int> <chr>     <chr>                       <chr>      <chr>        <chr>
1         1 insertion Paul Schmidt - BioMath GmbH 2026-02-14 y            This report anal...
2         2 insertion Paul Schmidt - BioMath GmbH 2026-02-14 e            This r**e**port ...
# ... with 2 more variables: page <int>, section <chr>
```

You can filter these tibbles with standard dplyr operations:

```r
# Show only comments
dplyr::filter(comments, grepl("code", comment_text))

# Show only insertions
dplyr::filter(changes, type == "insertion")
```

## Incorporating Feedback with an LLM

The structured Markdown output from `extract_review()` can be passed to any LLM
(ChatGPT, Claude, Gemini, etc.) to automate source revisions. Save the feedback
to a file and include it in your prompt:

```r
extract_review("example-report-reviewed.docx", output_file = "feedback.md")
```

Then ask the LLM:

> "Here is the review feedback from `feedback.md`. Please revise
> `example-report.qmd` to address all comments and tracked changes."

The LLM will typically:

1. Read the extracted comments and tracked changes.
2. Understand your source document's structure.
3. Apply the necessary edits — for our example:
   - Add `echo: false` to the YAML header (hiding R code).
   - Add `theme(text = element_text(size = 14))` to the ggplot (larger font).
   - Fix "analzes" → "analyzes" and "determin" → "determine" (typo
     corrections).
4. Report a summary of all changes made.

The revised QMD can then be re-rendered to produce a clean DOCX that addresses
all reviewer feedback.

### Claude Code + btw

[Claude Code](https://docs.anthropic.com/en/docs/claude-code) with the
[btw](https://github.com/posit-dev/btw) MCP server can run the entire workflow
in a single step — extracting feedback, reading the source, and applying edits.
docxreview ships with a Claude Code skill file. Register it via:

```r
system.file("skills", "docxreview", package = "docxreview")
```

Then open Claude Code and enter a prompt like:

> "Extract the review feedback from `example-report-reviewed.docx` and revise
> `example-report.qmd` to address all comments and tracked changes."

## Comparing Versions

After revising your source and re-rendering to `.docx`, you can produce a
comparison document with tracked changes so the reviewer sees exactly what
changed between versions:

```r
compare_versions("report_v1.docx", "report_v2.docx")
```

This creates a new `.docx` file with Word's built-in tracked changes showing
all differences. Note that this function requires Microsoft Word, Python, and
the `pywin32` package (Windows only).

## Try It Yourself

All example files are available in the
[vignettes/ directory](https://github.com/SchmidtPaul/docxreview/tree/master/vignettes)
of the GitHub repository. Download the QMD and the reviewed DOCX, then try the
LLM workflow described above — or start with the basic extraction:

```r
library(docxreview)
extract_review("example-report-reviewed.docx")
```
